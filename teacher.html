<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„ ìƒë‹˜ ëŒ€ì‹œë³´ë“œ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            height: 100vh;
            overflow: hidden;
        }
        
        /* ë ˆì´ì•„ì›ƒ */
        .dashboard {
            display: flex;
            height: 100vh;
        }
        
        /* ì™¼ìª½ ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            flex-direction: column;
            box-shadow: 4px 0 10px rgba(0,0,0,0.1);
        }
        
        .sidebar-header {
            padding: 30px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .sidebar-header h1 {
            font-size: 22px;
            margin-bottom: 10px;
        }
        
        .sidebar-header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        /* ì§„í–‰ ìƒí™© */
        .progress-area {
            padding: 20px;
            background: rgba(255,255,255,0.1);
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .progress-area h3 {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.8;
        }
        
        .progress-status {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            border-radius: 8px;
            font-size: 13px;
            min-height: 60px;
            display: none;
        }
        
        .progress-status.active {
            display: block;
        }
        
        /* ë©”ë‰´ */
        .menu {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .menu-item {
            padding: 15px 20px;
            margin-bottom: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .menu-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(5px);
        }
        
        .menu-item.active {
            background: white;
            color: #667eea;
            font-weight: bold;
        }
        
        .menu-icon {
            font-size: 20px;
        }
        
        /* ë¡œê·¸ì•„ì›ƒ */
        .logout-btn {
            margin: 20px;
            padding: 12px;
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* ë©”ì¸ ì»¨í…ì¸  */
        .main-content {
            flex: 1;
            background: #f5f5f5;
            overflow-y: auto;
            padding: 40px;
        }
        
        .content-section {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .content-section.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .content-section h2 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* í¼ ìŠ¤íƒ€ì¼ */
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-weight: bold;
            font-size: 15px;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        input[type="number"] {
            width: 100px;
        }
        
        button {
            padding: 14px 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        button.secondary {
            background: #28a745;
        }
        
        button.danger {
            background: #dc3545;
            padding: 8px 16px;
            font-size: 13px;
        }
        
        /* ğŸ”¥ êµ¬ê°„ ì¡°íšŒ ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        button.check-range {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            padding: 12px 24px;
            margin-top: 15px;
        }
        
        button.check-range:hover {
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.3);
        }
        
        /* ğŸ”¥ ì¡°íšŒ ê²°ê³¼ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .range-result-box {
            display: none;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border: 2px solid #667eea;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }
        
        .range-result-box.active {
            display: block;
            animation: slideDown 0.3s ease-out;
        }
        
        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .range-result-box h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .range-result-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }
        
        .range-result-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .range-result-item .label {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px;
        }
        
        .range-result-item .value {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
        }
        
        .range-result-item .unit {
            font-size: 14px;
            color: #999;
            margin-left: 4px;
        }
        
        .list-box {
            max-height: 250px;
            overflow-y: auto;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
        }
        
        .list-item {
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            border-radius: 8px;
            transition: background 0.2s;
        }
        
        .list-item:hover {
            background: #f0f0f0;
        }
        
        .list-item.selected {
            background: #e3f2fd;
            border: 2px solid #667eea;
        }
        
        .list-item input[type="radio"],
        .list-item input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }
        
        .status-box {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .status-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 14px;
        }
        
        .status-label {
            color: #666;
        }
        
        .status-value {
            font-weight: bold;
            color: #667eea;
        }
        
        .divider {
            border-top: 1px solid #e0e0e0;
            margin: 25px 0;
        }
        
        .problem-count-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .problem-count-row label {
            margin: 0;
            min-width: 100px;
        }
        
        .problem-count-row input {
            width: 100px;
        }
        
        .problem-count-row .max-info {
            font-size: 13px;
            color: #999;
        }
        
        .total-summary {
            background: #667eea;
            color: white;
            padding: 18px;
            border-radius: 10px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .message {
            padding: 15px 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 14px;
        }
        
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        /* ğŸ”¥ í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ */
        .hamburger {
            display: none;
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .hamburger span {
            display: block;
            width: 25px;
            height: 3px;
            background: white;
            margin: 5px 0;
            border-radius: 3px;
            transition: 0.3s;
        }
        
        /* ğŸ“± ëª¨ë°”ì¼ (0~767px) */
        @media (max-width: 767px) {
            .hamburger {
                display: block;
            }
            
            .sidebar {
                position: fixed;
                left: -280px;
                top: 0;
                height: 100vh;
                z-index: 1000;
                transition: left 0.3s ease;
            }
            
            .sidebar.active {
                left: 0;
            }
            
            .main-content {
                padding: 80px 15px 20px 15px;
                margin-left: 0;
            }
            
            .content-section {
                padding: 20px 15px;
                border-radius: 15px;
            }
            
            .content-section h2 {
                font-size: 22px;
                margin-bottom: 20px;
            }
            
            /* í¼ ìš”ì†Œ ëª¨ë°”ì¼ ìµœì í™” */
            input, select {
                padding: 14px 12px;
                font-size: 16px; /* iOS ìë™ ì¤Œ ë°©ì§€ */
            }
            
            button {
                padding: 16px 24px;
                font-size: 16px;
            }
            
            .list-box {
                max-height: 200px;
            }
            
            .problem-count-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .problem-count-row input {
                width: 100%;
            }
            
            .range-result-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .status-box {
                padding: 15px;
            }
            
            /* ì˜¤ë²„ë ˆì´ */
            .overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 999;
            }
            
            .overlay.active {
                display: block;
            }
        }
        
        /* ğŸ“± íƒœë¸”ë¦¿ (768px~1023px) */
        @media (min-width: 768px) and (max-width: 1023px) {
            .sidebar {
                width: 220px;
            }
            
            .sidebar-header h1 {
                font-size: 18px;
            }
            
            .sidebar-header p {
                font-size: 13px;
            }
            
            .menu-item {
                padding: 12px 15px;
                font-size: 14px;
            }
            
            .main-content {
                padding: 30px 20px;
            }
            
            .content-section {
                padding: 30px 25px;
            }
            
            .content-section h2 {
                font-size: 24px;
            }
            
            input, select {
                padding: 12px;
                font-size: 14px;
            }
            
            button {
                padding: 12px 24px;
                font-size: 15px;
            }
        }
        
        /* ğŸ’» ì‘ì€ ë°ìŠ¤í¬íƒ‘ (1024px~1279px) */
        @media (min-width: 1024px) and (max-width: 1279px) {
            .sidebar {
                width: 250px;
            }
            
            .main-content {
                padding: 35px;
            }
            
            .content-section {
                padding: 35px;
            }
        }
        
        /* ğŸ–¥ï¸ í° í™”ë©´ (1280px~) */
        @media (min-width: 1280px) {
            .content-section {
                max-width: 1400px;
            }
        }
        
        /* ê°€ë¡œëª¨ë“œ ëª¨ë°”ì¼ */
        @media (max-width: 767px) and (orientation: landscape) {
            .sidebar-header {
                padding: 20px 15px;
            }
            
            .sidebar-header h1 {
                font-size: 18px;
            }
            
            .menu-item {
                padding: 10px 15px;
                font-size: 13px;
            }
            
            .progress-area {
                padding: 15px;
            }
        }
        
        /* í„°ì¹˜ ë””ë°”ì´ìŠ¤ ìµœì í™” */
        @media (hover: none) and (pointer: coarse) {
            .menu-item {
                padding: 18px 20px;
            }
            
            button {
                min-height: 48px;
            }
            
            input, select {
                min-height: 48px;
            }
            
            .list-item {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- ğŸ”¥ í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ ì¶”ê°€ -->
    <button class="hamburger" onclick="toggleSidebar()">
        <span></span>
        <span></span>
        <span></span>
    </button>
    
    <!-- ğŸ”¥ ì˜¤ë²„ë ˆì´ ì¶”ê°€ -->
    <div class="overlay" onclick="toggleSidebar()"></div>
    
    <div class="dashboard">
        <!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>ğŸ“š ì„ ìƒë‹˜ ëŒ€ì‹œë³´ë“œ</h1>
                <p>í•™ìƒ ê´€ë¦¬ ì‹œìŠ¤í…œ</p>
            </div>
            
            <div class="progress-area">
                <h3>ì§„í–‰ ìƒí™©</h3>
                <div id="progressStatus" class="progress-status"></div>
            </div>
            
            <nav class="menu">
                <div class="menu-item active" onclick="showSection('homework')">
                    <span class="menu-icon">ğŸ“</span>
                    <span>ìˆ™ì œ ë“±ë¡</span>
                </div>
                <div class="menu-item" onclick="showSection('diagnostic')">
                    <span class="menu-icon">ğŸ”</span>
                    <span>ì§„ë‹¨í‰ê°€ ì¶œì œ</span>
                </div>
                <div class="menu-item" onclick="showSection('results')">
                    <span class="menu-icon">ğŸ“Š</span>
                    <span>ê²°ê³¼ ì¡°íšŒ</span>
                </div>
            </nav>
            
            <button class="logout-btn" onclick="logout()">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
        </aside>
        
        <!-- ë©”ì¸ ì»¨í…ì¸  -->
        <main class="main-content">
            <!-- ìˆ™ì œ ë“±ë¡ ì„¹ì…˜ -->
            <section id="homeworkSection" class="content-section active">
                <h2>ğŸ“ ìˆ™ì œ ë“±ë¡</h2>
                
                <form id="homeworkForm">
                    <div class="form-group">
                        <label>í•™ë…„ ì„ íƒ</label>
                        <select id="hwGrade" required>
                            <option value="">í•™ë…„ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì¤‘1">ì¤‘1</option>
                            <option value="ì¤‘2">ì¤‘2</option>
                            <option value="ì¤‘3">ì¤‘3</option>
                            <option value="ê³ 1">ê³ 1</option>
                            <option value="ê³ 2">ê³ 2</option>
                            <option value="ê³ 3">ê³ 3</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>í•™ìƒ ì„ íƒ</label>
                        <div id="hwStudentList" class="list-box">
                            <p style="color: #999; text-align: center; padding: 20px;">í•™ë…„ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ë¬¸ì œì§‘ ì„ íƒ</label>
                        <div id="hwBookList" class="list-box">
                            <p style="color: #999; text-align: center; padding: 20px;">í•™ìƒì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</p>
                        </div>
                    </div>
                    
                    <div class="divider"></div>
                    
                    <div id="hwProblemSettings" style="display: none;">
                        <h3 style="color: #667eea; margin-bottom: 20px;">ğŸ“‹ ìˆ™ì œ ë‚´ìš© ì„¤ì •</h3>
                        
                        <div class="form-group">
                            <label>ë²”ìœ„ ì„¤ì •</label>
                            <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                                <input type="number" id="hwRangeStart" placeholder="ì‹œì‘" style="width: 100px;" min="1">
                                <span>~</span>
                                <input type="number" id="hwRangeEnd" placeholder="ë" style="width: 100px;" min="1">
                            </div>
                        </div>
                        
                        <div class="problem-count-row">
                            <label>ì¼ë°˜ ìœ í˜•</label>
                            <input type="number" id="hwGeneral" value="0" min="0">
                            <span class="max-info">ë¬¸ì œ</span>
                        </div>
                        
                        <div class="problem-count-row">
                            <label>ì„œìˆ í˜•</label>
                            <input type="number" id="hwEssay" value="0" min="0">
                            <span class="max-info">ë¬¸ì œ</span>
                        </div>
                        
                        <div class="problem-count-row">
                            <label>1ë“±ê¸‰</label>
                            <input type="number" id="hwGrade1" value="0" min="0">
                            <span class="max-info">ë¬¸ì œ</span>
                        </div>
                        
                        <button type="submit" style="margin-top: 20px;">âœ… ìˆ™ì œ ë“±ë¡</button>
                    </div>
                    
                    <div id="hwMessage"></div>
                </form>
            </section>
            
            <!-- ì§„ë‹¨í‰ê°€ ì¶œì œ ì„¹ì…˜ -->
            <section id="diagnosticSection" class="content-section">
                <h2>ğŸ” ì§„ë‹¨í‰ê°€ ì¶œì œ</h2>
                
                <form id="diagForm">
                    <div class="form-group">
                        <label>í•™ë…„ ì„ íƒ</label>
                        <select id="diagGrade" required>
                            <option value="">í•™ë…„ì„ ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì¤‘1">ì¤‘1</option>
                            <option value="ì¤‘2">ì¤‘2</option>
                            <option value="ì¤‘3">ì¤‘3</option>
                            <option value="ê³ 1">ê³ 1</option>
                            <option value="ê³ 2">ê³ 2</option>
                            <option value="ê³ 3">ê³ 3</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>í•™ìƒ ì„ íƒ</label>
                        <div id="diagStudentList" class="list-box">
                            <p style="color: #999; text-align: center; padding: 20px;">í•™ë…„ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</p>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>ë¬¸ì œì§‘ ì„ íƒ</label>
                        <div id="diagBookList" class="list-box">
                            <p style="color: #999; text-align: center; padding: 20px;">í•™ìƒì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</p>
                        </div>
                    </div>
                    
                    <div class="divider"></div>
                    
                    <div id="diagProblemSettings" style="display: none;">
                        <h3 style="color: #667eea; margin-bottom: 20px;">ğŸ“‹ ì¶œì œ ì„¤ì •</h3>
                        
                        <div class="form-group">
                            <label>ì¶œì œ ë²”ìœ„ (ì—¬ëŸ¬ êµ¬ê°„ ê°€ëŠ¥)</label>
                            <div id="rangeContainer">
                                <div class="range-item" style="display: flex; gap: 10px; align-items: center; margin-bottom: 10px;">
                                    <input type="number" class="range-start" placeholder="ì‹œì‘" style="width: 100px;" min="1">
                                    <span>~</span>
                                    <input type="number" class="range-end" placeholder="ë" style="width: 100px;" min="1">
                                    <button type="button" class="danger" onclick="removeRange(this)">ì‚­ì œ</button>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button type="button" class="secondary" onclick="addRange()">+ ë²”ìœ„ ì¶”ê°€</button>
                                <!-- ğŸ”¥ êµ¬ê°„ ì¡°íšŒ ë²„íŠ¼ì„ ì—¬ê¸°ë¡œ ì´ë™ -->
                                <button type="button" class="check-range" onclick="checkRangeContent()">ğŸ” êµ¬ê°„ ì¡°íšŒ</button>
                            </div>
                        </div>
                        
                        <!-- ğŸ”¥ ì¡°íšŒ ê²°ê³¼ ë°•ìŠ¤ ì¶”ê°€ -->
                        <div id="rangeResultBox" class="range-result-box">
                            <h3>ğŸ“Š êµ¬ê°„ ë‚´ ë¬¸ì œ í˜„í™©</h3>
                            <div class="range-result-grid">
                                <div class="range-result-item">
                                    <div class="label">ì¼ë°˜ ìœ í˜•</div>
                                    <div class="value" id="resultGeneral">0</div>
                                    <span class="unit">ê°œ</span>
                                </div>
                                <div class="range-result-item">
                                    <div class="label">ì„œìˆ í˜•</div>
                                    <div class="value" id="resultEssay">0</div>
                                    <span class="unit">ê°œ</span>
                                </div>
                                <div class="range-result-item">
                                    <div class="label">1ë“±ê¸‰</div>
                                    <div class="value" id="resultGrade1">0</div>
                                    <span class="unit">ê°œ</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="divider"></div>
                        
                        <div class="problem-count-row">
                            <label>ëŒ€í‘œ ë¬¸ì œ (ê·¸ë£¹)</label>
                            <input type="number" id="diagGroupCount" value="0" min="0">
                            <span class="max-info">ê·¸ë£¹</span>
                        </div>
                        
                        <div class="problem-count-row">
                            <label>ì„œìˆ í˜•</label>
                            <input type="number" id="diagEssay" value="0" min="0">
                            <span class="max-info">ë¬¸ì œ</span>
                        </div>
                        
                        <div class="problem-count-row">
                            <label>1ë“±ê¸‰ (ë„ì „)</label>
                            <input type="number" id="diagGrade1" value="0" min="0">
                            <span class="max-info">ë¬¸ì œ</span>
                        </div>
                        
                        <button type="submit" style="margin-top: 20px;">ğŸ¯ ì§„ë‹¨í‰ê°€ ì¶œì œ</button>
                    </div>
                    
                    <div id="diagMessage"></div>
                </form>
            </section>
            
            <!-- ê²°ê³¼ ì¡°íšŒ ì„¹ì…˜ -->
            <section id="resultsSection" class="content-section">
                <h2>ğŸ“Š ê²°ê³¼ ì¡°íšŒ</h2>
                <p style="color: #666; font-size: 15px;">í•™ìƒë³„ ìˆ™ì œ ì œì¶œ í˜„í™©ê³¼ ì˜¤ë‹µ í˜„í™©ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                <div style="margin-top: 30px; padding: 40px; background: #f9f9f9; border-radius: 10px; text-align: center;">
                    <p style="color: #999;">ğŸš§ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤</p>
                </div>
            </section>
        </main>
    </div>

    <script>
        const API_URL = 'https://script.google.com/macros/s/AKfycbwbRwdUwt3P7HsGbaXUUjIo4xoRkWSiVt-9TEuWqInu53lKq14Y3NNdvuOIGDB8S39Q/exec';
        
        let hwSelectedStudent = null;
        let hwSelectedBook = null;
        let diagSelectedStudent = null;
        let diagSelectedBook = null;
        
        let callbackCounter = 0;
        
        // API í˜¸ì¶œ ê³µí†µ í•¨ìˆ˜ (JSONP ë°©ì‹)
        function callAPI(action, params = {}) {
            return new Promise((resolve, reject) => {
                const callbackName = 'jsonpCallback' + (callbackCounter++);
                
                window[callbackName] = function(data) {
                    delete window[callbackName];
                    document.body.removeChild(script);
                    resolve(data);
                };
                
                const queryParams = new URLSearchParams({
                    action: action,
                    callback: callbackName,
                    ...params
                });
                
                const script = document.createElement('script');
                script.src = `${API_URL}?${queryParams.toString()}`;
                script.onerror = () => {
                    delete window[callbackName];
                    document.body.removeChild(script);
                    reject(new Error('API í˜¸ì¶œ ì‹¤íŒ¨'));
                };
                
                document.body.appendChild(script);
            });
        }
        
        // ì§„í–‰ ìƒí™© í‘œì‹œ
        function showProgress(message) {
            const progressStatus = document.getElementById('progressStatus');
            progressStatus.textContent = message;
            progressStatus.classList.add('active');
        }
        
        function hideProgress() {
            const progressStatus = document.getElementById('progressStatus');
            progressStatus.classList.remove('active');
        }
        
        // ì„¹ì…˜ ì „í™˜
        function showSection(section) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            
            if (section === 'homework') {
                document.getElementById('homeworkSection').classList.add('active');
                document.querySelectorAll('.menu-item')[0].classList.add('active');
            } else if (section === 'diagnostic') {
                document.getElementById('diagnosticSection').classList.add('active');
                document.querySelectorAll('.menu-item')[1].classList.add('active');
            } else if (section === 'results') {
                document.getElementById('resultsSection').classList.add('active');
                document.querySelectorAll('.menu-item')[2].classList.add('active');
            }
        }
        
        // ìˆ™ì œ - í•™ë…„ ì„ íƒ
        document.getElementById('hwGrade').addEventListener('change', async (e) => {
            const grade = e.target.value;
            if (!grade) return;
            
            showProgress('í•™ìƒ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
            
            try {
                const data = await callAPI('getStudentsByGrade', { grade });
                
                const listDiv = document.getElementById('hwStudentList');
                if (data.students && data.students.length > 0) {
                    listDiv.innerHTML = data.students.map(student => `
                        <label class="list-item">
                            <input type="radio" name="hwStudent" value="${student.id}">
                            <span>${student.name}</span>
                        </label>
                    `).join('');
                    
                    // ë¼ë””ì˜¤ ë²„íŠ¼ ì´ë²¤íŠ¸
                    document.querySelectorAll('input[name="hwStudent"]').forEach(radio => {
                        radio.addEventListener('change', loadHwBooks);
                    });
                } else {
                    listDiv.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤</p>';
                }
                
                hideProgress();
            } catch (error) {
                hideProgress();
                alert('í•™ìƒ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message);
            }
        });
        
        // ìˆ™ì œ - ë¬¸ì œì§‘ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadHwBooks() {
            const selectedRadio = document.querySelector('input[name="hwStudent"]:checked');
            if (!selectedRadio) return;
            
            hwSelectedStudent = selectedRadio.value;
            
            showProgress('ë¬¸ì œì§‘ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
            
            try {
                const data = await callAPI('getStudentBooks', { student_id: hwSelectedStudent });
                
                const listDiv = document.getElementById('hwBookList');
                if (data.books && data.books.length > 0) {
                    listDiv.innerHTML = data.books.map(book => `
                        <label class="list-item">
                            <input type="radio" name="hwBook" value="${book}">
                            <span>${book}</span>
                        </label>
                    `).join('');
                    
                    // ë¼ë””ì˜¤ ë²„íŠ¼ ì´ë²¤íŠ¸
                    document.querySelectorAll('input[name="hwBook"]').forEach(radio => {
                        radio.addEventListener('change', () => {
                            hwSelectedBook = radio.value;
                            // í•™ìƒ í˜„í™© ì¡°íšŒ í›„ ìˆ™ì œ ì„¤ì • í‘œì‹œ
                            loadStudentStatus();
                        });
                    });
                } else {
                    listDiv.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">ë“±ë¡ëœ ë¬¸ì œì§‘ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                }
                
                hideProgress();
            } catch (error) {
                hideProgress();
                alert('ë¬¸ì œì§‘ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ğŸ”¥ í•™ìƒ í˜„í™© ì¡°íšŒ (ìƒˆë¡œ ì¶”ê°€!)
        async function loadStudentStatus() {
            showProgress('í•™ìƒ í˜„í™© ì¡°íšŒ ì¤‘...');
            
            try {
                const data = await callAPI('getStudentStatus', {
                    student_id: hwSelectedStudent,
                    book_name: hwSelectedBook
                });
                
                hideProgress();
                
                if (data.success) {
                    // í˜„í™© ì •ë³´ ì €ì¥
                    window.studentStatus = data.status;
                    
                    // ì…ë ¥ í•„ë“œì— max ê°’ ì„¤ì •
                    document.getElementById('hwGeneral').max = data.status.review.general;
                    document.getElementById('hwEssay').max = data.status.review.essay;
                    document.getElementById('hwGrade1').max = data.status.review.grade1;
                    
                    // ìˆ™ì œ ì„¤ì • ì˜ì—­ í‘œì‹œ
                    document.getElementById('hwProblemSettings').style.display = 'block';
                    
                    // í˜„í™© ì •ë³´ í‘œì‹œ (ìˆ™ì œ ì„¤ì • ìœ„ì— ì¶”ê°€)
                    updateStatusDisplay(data.status);
                } else {
                    alert('í•™ìƒ í˜„í™© ì¡°íšŒ ì‹¤íŒ¨: ' + data.message);
                }
            } catch (error) {
                hideProgress();
                alert('í•™ìƒ í˜„í™© ì¡°íšŒ ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ğŸ”¥ í˜„í™© ì •ë³´ í‘œì‹œ í•¨ìˆ˜ (ìƒˆë¡œ ì¶”ê°€!)
        function updateStatusDisplay(status) {
            // ê¸°ì¡´ í˜„í™© ë°•ìŠ¤ ì œê±°
            const existingStatus = document.getElementById('hwStatusDisplay');
            if (existingStatus) existingStatus.remove();
            
            // ìƒˆ í˜„í™© ë°•ìŠ¤ ìƒì„±
            const statusHTML = `
                <div id="hwStatusDisplay" class="status-box" style="margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <h4 style="color: #667eea; font-size: 16px;">ğŸ“Š ${hwSelectedStudent} - ${hwSelectedBook}</h4>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px;">
                            <h5 style="color: #1976d2; margin-bottom: 10px; font-size: 14px;">ğŸ”„ ë³µìŠµ ê°€ëŠ¥ (í‹€ë¦° ë¬¸ì œ)</h5>
                            <div style="font-size: 13px; line-height: 1.8;">
                                <div>ì¼ë°˜ìœ í˜•: <strong style="color: #667eea;">${status.review.general}ê°œ</strong></div>
                                <div>ì„œìˆ í˜•: <strong style="color: #667eea;">${status.review.essay}ê°œ</strong></div>
                                <div>1ë“±ê¸‰: <strong style="color: #667eea;">${status.review.grade1}ê°œ</strong></div>
                            </div>
                        </div>
                        
                        <div style="background: #fff3e0; padding: 15px; border-radius: 8px;">
                            <h5 style="color: #f57c00; margin-bottom: 10px; font-size: 14px;">âœ¨ ì•ˆ í‘¼ ë¬¸ì œ</h5>
                            <div style="font-size: 13px; line-height: 1.8;">
                                <div>ì¼ë°˜ìœ í˜•: <strong style="color: #667eea;">${status.unsolved.general}ê°œ</strong></div>
                                <div>ì„œìˆ í˜•: <strong style="color: #667eea;">${status.unsolved.essay}ê°œ</strong></div>
                                <div>1ë“±ê¸‰: <strong style="color: #667eea;">${status.unsolved.grade1}ê°œ</strong></div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // hwProblemSettings ì•ì— ì‚½ì…
            const problemSettings = document.getElementById('hwProblemSettings');
            problemSettings.insertAdjacentHTML('beforebegin', statusHTML);
        }
        
        // ìˆ™ì œ ì œì¶œ
        document.getElementById('homeworkForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!hwSelectedStudent || !hwSelectedBook) {
                showMessage('hwMessage', 'í•™ìƒê³¼ ë¬¸ì œì§‘ì„ ì„ íƒí•˜ì„¸ìš”.', 'error');
                return;
            }
            
            const rangeStart = parseInt(document.getElementById('hwRangeStart').value);
            const rangeEnd = parseInt(document.getElementById('hwRangeEnd').value);
            
            if (!rangeStart || !rangeEnd || rangeStart > rangeEnd) {
                showMessage('hwMessage', 'ì˜¬ë°”ë¥¸ ë²”ìœ„ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }
            
            const general = parseInt(document.getElementById('hwGeneral').value) || 0;
            const essay = parseInt(document.getElementById('hwEssay').value) || 0;
            const grade1 = parseInt(document.getElementById('hwGrade1').value) || 0;
            
            if (general === 0 && essay === 0 && grade1 === 0) {
                showMessage('hwMessage', 'ìµœì†Œ 1ë¬¸ì œ ì´ìƒ ì¶œì œí•´ì•¼ í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            showProgress('ğŸ“ ìˆ™ì œ ë“±ë¡ ì¤‘...');
            showMessage('hwMessage', 'â³ ìˆ™ì œë¥¼ ë“±ë¡í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'success');
            
            try {
                const data = await callAPI('registerHomework', {
                    student_id: hwSelectedStudent,
                    book_name: hwSelectedBook,
                    range_start: rangeStart,
                    range_end: rangeEnd,
                    general_count: general,
                    essay_count: essay,
                    grade1_count: grade1
                });
                
                hideProgress();
                
                if (data.success) {
                    showMessage('hwMessage', `âœ… ${data.message}`, 'success');
                    
                    // í¼ ì´ˆê¸°í™”
                    document.getElementById('hwRangeStart').value = '';
                    document.getElementById('hwRangeEnd').value = '';
                    document.getElementById('hwGeneral').value = '0';
                    document.getElementById('hwEssay').value = '0';
                    document.getElementById('hwGrade1').value = '0';
                } else {
                    showMessage('hwMessage', data.message, 'error');
                }
            } catch (error) {
                hideProgress();
                showMessage('hwMessage', 'ìˆ™ì œ ë“±ë¡ ì‹¤íŒ¨: ' + error.message, 'error');
                console.error(error);
            }
        });
        
        // ì§„ë‹¨í‰ê°€ - í•™ë…„ ì„ íƒ
        document.getElementById('diagGrade').addEventListener('change', async (e) => {
            const grade = e.target.value;
            if (!grade) return;
            
            showProgress('í•™ìƒ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
            
            try {
                const data = await callAPI('getStudentsByGrade', { grade });
                
                const listDiv = document.getElementById('diagStudentList');
                if (data.students && data.students.length > 0) {
                    listDiv.innerHTML = data.students.map(student => `
                        <label class="list-item">
                            <input type="radio" name="diagStudent" value="${student.id}">
                            <span>${student.name}</span>
                        </label>
                    `).join('');
                    
                    // ë¼ë””ì˜¤ ë²„íŠ¼ ì´ë²¤íŠ¸
                    document.querySelectorAll('input[name="diagStudent"]').forEach(radio => {
                        radio.addEventListener('change', loadDiagBooks);
                    });
                } else {
                    listDiv.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤</p>';
                }
                
                hideProgress();
            } catch (error) {
                hideProgress();
                alert('í•™ìƒ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message);
            }
        });
        
        // ì§„ë‹¨í‰ê°€ - ë¬¸ì œì§‘ ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadDiagBooks() {
            const selectedRadio = document.querySelector('input[name="diagStudent"]:checked');
            if (!selectedRadio) return;
            
            diagSelectedStudent = selectedRadio.value;
            
            showProgress('ë¬¸ì œì§‘ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...');
            
            try {
                const data = await callAPI('getStudentBooks', { student_id: diagSelectedStudent });
                
                const listDiv = document.getElementById('diagBookList');
                if (data.books && data.books.length > 0) {
                    listDiv.innerHTML = data.books.map(book => `
                        <label class="list-item">
                            <input type="radio" name="diagBook" value="${book}">
                            <span>${book}</span>
                        </label>
                    `).join('');
                    
                    // ë¼ë””ì˜¤ ë²„íŠ¼ ì´ë²¤íŠ¸
                    document.querySelectorAll('input[name="diagBook"]').forEach(radio => {
                        radio.addEventListener('change', () => {
                            diagSelectedBook = radio.value;
                            document.getElementById('diagProblemSettings').style.display = 'block';
                        });
                    });
                } else {
                    listDiv.innerHTML = '<p style="color: #999; text-align: center; padding: 20px;">ë“±ë¡ëœ ë¬¸ì œì§‘ì´ ì—†ìŠµë‹ˆë‹¤</p>';
                }
                
                hideProgress();
            } catch (error) {
                hideProgress();
                alert('ë¬¸ì œì§‘ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨: ' + error.message);
            }
        }
        
        // ë²”ìœ„ ì¶”ê°€
        function addRange() {
            const container = document.getElementById('rangeContainer');
            const newRange = document.createElement('div');
            newRange.className = 'range-item';
            newRange.style.cssText = 'display: flex; gap: 10px; align-items: center; margin-bottom: 10px;';
            newRange.innerHTML = `
                <input type="number" class="range-start" placeholder="ì‹œì‘" style="width: 100px;" min="1">
                <span>~</span>
                <input type="number" class="range-end" placeholder="ë" style="width: 100px;" min="1">
                <button type="button" class="danger" onclick="removeRange(this)">ì‚­ì œ</button>
            `;
            container.appendChild(newRange);
        }
        
        // ë²”ìœ„ ì‚­ì œ
        function removeRange(button) {
            const container = document.getElementById('rangeContainer');
            if (container.children.length > 1) {
                button.parentElement.remove();
            } else {
                alert('ìµœì†Œ 1ê°œì˜ ë²”ìœ„ëŠ” í•„ìš”í•©ë‹ˆë‹¤.');
            }
        }
        
        // ğŸ”¥ êµ¬ê°„ ì¡°íšŒ í•¨ìˆ˜ ì¶”ê°€
        async function checkRangeContent() {
            if (!diagSelectedStudent) {
                alert('í•™ìƒì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            if (!diagSelectedBook) {
                alert('ë¬¸ì œì§‘ì„ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”.');
                return;
            }
            
            const ranges = [];
            document.querySelectorAll('.range-item').forEach(item => {
                const start = parseInt(item.querySelector('.range-start').value);
                const end = parseInt(item.querySelector('.range-end').value);
                if (start && end && start <= end) {
                    ranges.push({ start, end });
                }
            });
            
            if (ranges.length === 0) {
                alert('ì¶œì œ ë²”ìœ„ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
                return;
            }
            
            showProgress('ğŸ” êµ¬ê°„ ì¡°íšŒ ì¤‘...');
            
            try {
                const data = await callAPI('checkRangeContent', {
                    student_id: diagSelectedStudent,
                    book_name: diagSelectedBook,
                    ranges: JSON.stringify(ranges)
                });
                
                hideProgress();
                
                if (data.success) {
                    // ê²°ê³¼ ë°•ìŠ¤ í‘œì‹œ
                    const resultBox = document.getElementById('rangeResultBox');
                    resultBox.classList.add('active');
                    
                    // ê° ê°’ ì—…ë°ì´íŠ¸
                    document.getElementById('resultGeneral').textContent = data.counts.general || 0;
                    document.getElementById('resultEssay').textContent = data.counts.essay || 0;
                    document.getElementById('resultGrade1').textContent = data.counts.grade1 || 0;
                    
                    // ë¶€ë“œëŸ½ê²Œ ìŠ¤í¬ë¡¤
                    resultBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    alert('êµ¬ê°„ ì¡°íšŒ ì‹¤íŒ¨: ' + data.message);
                }
            } catch (error) {
                hideProgress();
                alert('êµ¬ê°„ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
                console.error(error);
            }
        }
        
        // ì§„ë‹¨í‰ê°€ ì œì¶œ
        document.getElementById('diagForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!diagSelectedStudent) {
                showMessage('diagMessage', 'í•™ìƒì„ ì„ íƒí•˜ì„¸ìš”.', 'error');
                return;
            }
            
            if (!diagSelectedBook) {
                showMessage('diagMessage', 'ë¬¸ì œì§‘ì„ ì„ íƒí•˜ì„¸ìš”.', 'error');
                return;
            }
            
            const ranges = [];
            document.querySelectorAll('.range-item').forEach(item => {
                const start = parseInt(item.querySelector('.range-start').value);
                const end = parseInt(item.querySelector('.range-end').value);
                if (start && end && start <= end) {
                    ranges.push({ start, end });
                }
            });
            
            if (ranges.length === 0) {
                showMessage('diagMessage', 'ì¶œì œ ë²”ìœ„ë¥¼ ì…ë ¥í•˜ì„¸ìš”.', 'error');
                return;
            }
            
            const groupCount = parseInt(document.getElementById('diagGroupCount').value) || 0;
            const essayCount = parseInt(document.getElementById('diagEssay').value) || 0;
            const grade1Count = parseInt(document.getElementById('diagGrade1').value) || 0;
            
            if (groupCount === 0 && essayCount === 0 && grade1Count === 0) {
                showMessage('diagMessage', 'ìµœì†Œ 1ë¬¸ì œ ì´ìƒ ì¶œì œí•´ì•¼ í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            showProgress('ğŸ“‹ ì§„ë‹¨í‰ê°€ ì¶œì œ ì¤‘...');
            showMessage('diagMessage', 'â³ ì§„ë‹¨í‰ê°€ ì¶œì œ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...', 'success');
            
            try {
                const data = await callAPI('createDiagnosticTest', {
                    student_id: diagSelectedStudent,
                    book_name: diagSelectedBook,
                    ranges: JSON.stringify(ranges),
                    group_count: groupCount,
                    essay_count: essayCount,
                    grade1_count: grade1Count
                });
                
                hideProgress();
                
                if (data.success) {
                    showMessage('diagMessage', `âœ… ${data.message}`, 'success');
                    
                    // í•™ìƒ ì´ë¦„ ê°€ì ¸ì˜¤ê¸° (ë¼ë””ì˜¤ ë²„íŠ¼ì—ì„œ)
                    const selectedRadio = document.querySelector('input[name="diagStudent"]:checked');
                    const studentLabel = selectedRadio ? selectedRadio.nextElementSibling.textContent.trim() : diagSelectedStudent;
                    
                    // ìƒˆ ì°½ì—ì„œ ì¶œë ¥ í™”ë©´ ì—´ê¸°
                    openPrintWindow(studentLabel, diagSelectedBook, data.problems);
                } else {
                    showMessage('diagMessage', data.message, 'error');
                }
            } catch (error) {
                hideProgress();
                showMessage('diagMessage', 'ì§„ë‹¨í‰ê°€ ì¶œì œ ì‹¤íŒ¨: ' + error.message, 'error');
                console.error(error);
            }
        });
        
        // ì§„ë‹¨í‰ê°€ ì¶œë ¥ ì°½ ì—´ê¸°
        function openPrintWindow(studentName, bookName, problems) {
            const printWindow = window.open('', '_blank', 'width=900,height=800');
            
            const html = `
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ì§„ë‹¨í‰ê°€ - ${studentName}</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Malgun Gothic', sans-serif;
      padding: 20px;
      background: #f5f5f5;
    }
    
    /* ì¢Œì¸¡ ìƒë‹¨ í•™ìƒ ì´ë¦„ */
    .student-badge {
      position: fixed;
      top: 20px;
      left: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 20px;
      border-radius: 25px;
      font-weight: bold;
      font-size: 16px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      z-index: 1000;
    }
    
    .header {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      text-align: center;
      margin-top: 60px;
    }
    
    h1 {
      color: #667eea;
      margin-bottom: 10px;
    }
    
    .info {
      color: #666;
      margin-bottom: 20px;
    }
    
    .print-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 15px 40px;
      font-size: 18px;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      transition: transform 0.2s;
    }
    
    .print-btn:hover {
      transform: translateY(-2px);
    }
    
    .print-btn:active {
      transform: translateY(0);
    }
    
    /* 4ë¶„í•  ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
    .page {
      background: white;
      page-break-after: always;
      padding: 10mm;
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap: 5mm;
      min-height: 277mm; /* A4 ì„¸ë¡œ ê¸¸ì´ */
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    
    .page:last-child {
      page-break-after: auto;
    }
    
    .problem {
      padding: 8px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    
    .problem h3 {
      color: #333;
      font-size: 14px;
      margin-bottom: 8px;
      padding-bottom: 5px;
      border-bottom: 2px solid #667eea;
      flex-shrink: 0;
    }
    
    .problem img {
      width: 100%;
      height: auto;
      max-height: calc(100% - 40px);
      object-fit: contain;
    }
    
    /* ì¸ì‡„ìš© ìŠ¤íƒ€ì¼ */
    @media print {
      @page {
        size: A4;
        margin: 0;
      }
      
      body {
        background: white;
        padding: 0;
        margin: 0;
      }
      
      .student-badge {
        position: absolute;
        top: 5mm;
        left: 5mm;
        font-size: 14px;
        padding: 8px 15px;
      }
      
      .header {
        display: none;
      }
      
      .print-btn {
        display: none;
      }
      
      .page {
        box-shadow: none;
        margin: 0;
        padding: 15mm 10mm 10mm 10mm;
        min-height: 297mm;
      }
    }
  </style>
</head>
<body>
  <div class="student-badge">
    ğŸ‘¤ ${studentName}
  </div>
  
  <div class="header">
    <h1>ğŸ“ ì§„ë‹¨í‰ê°€: ${bookName}</h1>
    <p class="info">ì¶œì œì¼: ${new Date().toLocaleDateString('ko-KR')}</p>
    <button class="print-btn" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„í•˜ê¸°</button>
  </div>
  
  ${(() => {
    let html = '';
    let pageHtml = '';
    
    problems.forEach((problemNum, index) => {
      const paddedNum = problemNum.toString().padStart(4, '0');
      
      pageHtml += `
        <div class="problem">
          <h3>ë¬¸ì œ ${index + 1}. (ì›ë³¸ ${problemNum}ë²ˆ)</h3>
          <img src="problems/${bookName}/${paddedNum}.png" alt="ë¬¸ì œ ${problemNum}">
        </div>
      `;
      
      // 4ë¬¸ì œë§ˆë‹¤ í˜ì´ì§€ ìƒì„±
      if ((index + 1) % 4 === 0 || index === problems.length - 1) {
        html += `<div class="page">${pageHtml}</div>`;
        pageHtml = '';
      }
    });
    
    return html;
  })()}
  
</body>
</html>
            `;
            
            printWindow.document.write(html);
            printWindow.document.close();
        }
        
        // ë¡œê·¸ì•„ì›ƒ
        function logout() {
            sessionStorage.clear();
            window.location.href = 'index.html';
        }
        
        // ë©”ì‹œì§€ í‘œì‹œ
        function showMessage(elementId, message, type) {
            const messageDiv = document.getElementById(elementId);
            messageDiv.innerHTML = `<div class="message ${type}">${message}</div>`;
            
            setTimeout(() => {
                if (type === 'error') {
                    messageDiv.innerHTML = '';
                }
            }, 5000);
        }
        
        // ğŸ”¥ ì‚¬ì´ë“œë°” í† ê¸€ í•¨ìˆ˜ (ëª¨ë°”ì¼ìš©)
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.querySelector('.overlay');
            
            sidebar.classList.toggle('active');
            overlay.classList.toggle('active');
        }
        
        // ë©”ë‰´ í´ë¦­ ì‹œ ëª¨ë°”ì¼ì—ì„œ ì‚¬ì´ë“œë°” ìë™ ë‹«ê¸°
        document.querySelectorAll('.menu-item').forEach(item => {
            item.addEventListener('click', () => {
                if (window.innerWidth <= 767) {
                    toggleSidebar();
                }
            });
        });
    </script>
</body>
</html>
